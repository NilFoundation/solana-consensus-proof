version: '3'
volumes:
    grafana: {}
    prometheus: {}
    log_exporter: {}
services:
  grafana:
    user: "0"
    image: grafana/grafana
    container_name: grafana
    links:
      - "prometheus"
      - "renderer"
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /root/zerg/db_data/grafana_database:/data
    environment:
      - GF_SERVER_ROOT_URL=http://167.235.233.17:3000
#      - GF_SMTP_ENABLED=true
#      - GF_SMTP_HOST=smtp.yandex.ru:465
#      - GF_SMTP_USER=notifications@nil.foundation
#      - GF_SMTP_PASSWORD=XXXXXXX
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTO_DISABLE_LOGIN_FORM=true
      - GF_SMTP_FROM_ADDRESS=notifications@nil.foundation
      - GF_SMTP_FROM_NAME=Grafana
      - GF_PATHS_DATA=/data
      - GF_RENDERING_SERVER_URL=http://renderer:8081/render
      - GF_RENDERING_CALLBACK_URL=http://grafana:3000/
      - GF_LOG_FILTERS=rendering:debug
    expose:
      - 3000
    ports:
      - "3000:3000"
  renderer:
    image: grafana/grafana-image-renderer:latest
    ports:
      - 8081
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
#    links:
#      - "data_exporter"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - /etc/localtime:/etc/localtime:ro
      - /root/zerg/db_data/prometheus_database:/prometheus/data
    command:
      - "--config.file=/etc/prometheus/prometheus.yml"
      - "--web.listen-address=:3001"
    expose:
      - "3001"
    ports:
      - "3001:3001"
#  data_exporter:
#    build: data-exporter
#    container_name: data_exporter
#    expose:
#      - 3005
#    ports:
#      - 3005
